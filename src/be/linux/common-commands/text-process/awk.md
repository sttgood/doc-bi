---
title: awk
article: false
order: 
---

awk命令是Linux和Unix系统中一个非常强大的文本处理工具，它基于awk编程语言，主要用于数据扫描、过滤、统计汇总等工作。awk命令可以处理来自标准输入、管道或文件的数据，非常适合用于结构化文本文件（如CSV文件、日志文件等）的处理。以下是对awk命令的详细解析：

### 一、基本语法

awk命令的基本语法格式如下：

```bash
bash复制代码

awk [options] 'pattern { action } pattern { action } ...' input_file
```

其中：

- `options`：表示awk命令的选项，如-F指定字段分隔符，-f从文件中读取awk程序，-v设置变量等。
- `pattern`：是一个正则表达式或布尔表达式，用于匹配需要处理的行。
- `action`：是在匹配到符合条件的行时执行的动作，通常放在大括号`{}`中。
- `input_file`：是待处理的文件名。

### 二、常用选项

- `-F fs`：使用fs作为输入记录的字段分隔符，如果省略该选项，awk使用环境变量IFS的值。
- `-f filename`：从文件filename中读取awk脚本。
- `-v var=value`：为awk脚本设置变量。

### 三、记录和字段

awk将读入的记录分割成字段，默认情况下，字段的分隔符是空格或制表符。可以使用-F选项指定其他分隔符。awk中几个特殊的变量用于表示记录和字段：

- `$0`：表示当前行的所有文本。
- `$1, $2, ...`：表示当前行的第一列、第二列等。
- `NF`：表示当前行的字段数。
- `NR`：表示当前行的行号。

### 四、内置变量与函数

awk提供了许多内置变量和函数，用于处理和操作数据。

#### 内置变量

- `FILENAME`：当前文件名。
- `RS`：输入数据的行分隔符，默认为换行符`\n`。
- `OFS`：输出字段的分隔符（列分隔符），默认为空格。
- `ORS`：输出记录的分隔符。

#### 内置函数

- `split(str, arr, sep)`：将字符串str按照分隔符sep拆分，并将结果存储到数组arr中。
- `length(str)`：返回字符串str的长度。
- `index(str, substr)`：返回字符串substr在str中第一次出现的位置。
- `substr(str, start, length)`：返回从字符串str的start位置开始，长度为length的子串。
- `match(s, r)`：测试字符串s是否包含匹配r的字符串。
- `tolower(str)`：将字符串str转换为小写。
- `toupper(str)`：将字符串str转换为大写。
- `gsub(r, s[, t])`：在整个t中用s替代r。
- `sub(r, s[, t])`：用s替换t中第一次出现的r。

### 五、模式匹配与条件判断

awk支持正则表达式匹配、数值比较和字符串匹配等模式匹配操作。可以使用逻辑运算符（如&&、||、!）连接多个条件构成混合表达式。

### 六、动作与输出

在awk命令中，动作部分是在匹配到符合条件的行时执行的操作。常见的动作包括打印字段、赋值、计算等。awk默认的动作是打印当前输入记录，即`{print $0}`。可以使用`printf`函数进行格式化输出。

### 七、BEGIN与END块

BEGIN块在读取任何数据记录之前执行一次，通常用于数据初始化。END块在读取完所有数据记录后执行一次，通常用于数据汇总。

### 八、示例应用

1. **打印特定字段**：

```bash
bash复制代码

awk '{ print $1, $2 }' input_file
```

该命令将打印input_file文件中的第一列和第二列。

1. **按条件打印**：

```bash
bash复制代码

awk '{ if ($2 > 10) print $0 }' input_file
```

该命令将打印input_file文件中第二列大于10的行。

1. **统计行数**：

```bash
bash复制代码

awk 'END { print NR }' input_file
```

该命令将统计input_file文件的行数。

1. **计算字段总和**：

```bash
bash复制代码

awk '{ sum += $1 } END { print sum }' input_file
```

该命令将计算input_file文件中第一列数字的总和。

1. **格式化输出**：

```bash
bash复制代码

awk '{ printf "%-10s %-10s %-10s\n", $1, $2, $3 }' input_file
```

该命令将按指定的格式打印input_file文件的每一行。

综上所述，awk命令是一个功能强大的文本处理工具，通过灵活使用其语法、选项、内置变量与函数以及模式匹配与条件判断等功能，可以高效地处理和分析文本数据。