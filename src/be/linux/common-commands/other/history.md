---
title: history
article: false
order: 
---

history命令在Linux系统中用于显示和管理命令行的历史记录。以下是对history命令的详细解析：

### 一、基本语法

```bash
bash复制代码

history [选项] [历史记录编号]
```

### 二、常用选项

1. **无选项**：直接输入`history`会显示当前会话的所有历史命令。
2. **数字N**：`history N`会显示最近的N条历史记录。例如，`history 10`会显示最近的10条历史记录。
3. **-c**：清除当前shell会话的历史记录。
4. **-d OFFSET**：删除指定偏移的历史命令。例如，`history -d 42`会删除编号为42的历史记录。
5. **-w**：将当前会话的历史记录写入历史文件（通常为`~/.bash_history`）。
6. **-r**：从历史文件中读取命令，并将其附加到当前会话的历史记录列表中。
7. **-a**：将当前会话的历史记录追加到历史文件中，而不是覆盖。
8. **-n**：读取尚未从历史文件中读取的所有历史记录条目。这通常与`-r`选项一起使用，以确保所有历史记录都被加载到当前会话中。
9. **-p STRING**：打印以指定字符串开头的命令，但不执行它们。例如，`history -p ls`会打印所有包含`ls`的命令。
10. **-s STRING**：将指定的字符串添加到命令历史记录中，但不执行它。

### 三、高级用法

1. **执行历史命令**：
   - `!!`：执行上一条命令。
   - `!N`：执行历史记录中的第N条命令。
   - `!STRING`：执行最近的一条以STRING开头的命令。
   - `!?STRING`：执行最近的一条包含STRING的命令。
2. **命令替换**：
   - `^old^new^`：用上一条命令中的new替换old。例如，`^foo^bar^`会将上一条命令中的foo替换为bar。
   - `!$:gs/old/new/`：在上一条命令的最后一个参数中替换old为new。
   - `!!:gs/old/new/`：在上一条命令中替换old为new。
3. **引用历史命令的参数**：
   - `!$`：引用上一条命令的最后一个参数。
   - `!^`或`!!:0`：引用上一条命令的整个命令行。
   - `!!:1`：引用上一条命令的第一个单词。
   - `!$:2`：引用上一条命令的第二个参数（注意这里与`!$`结合使用时表示第二个单词，但单独使用时通常表示对最后一个参数的某种操作，因此这里可能是一个特例或误解，更常见的用法是`!N:M`表示引用第N条命令的第M个参数）。
   - `!*`：代表上一条命令的所有参数。
4. **设置历史记录相关变量**：
   - `export HISTTIMEFORMAT="%F %T "`：设置历史命令显示时间戳。这样，在使用`history`命令时，每条命令旁边都会显示执行的时间。
   - `export HISTSIZE=5000`：设置历史记录保存数量为5000。这决定了当前shell会话中可以保存的历史命令数量。
   - `export HISTFILESIZE=10000`：设置历史文件中保存的最大命令数。这决定了历史文件中可以保存的历史命令总数。
5. **搜索历史记录**：
   - 可以使用`grep`命令结合`history`来搜索包含特定字符串的历史命令。例如，`history | grep "k"`会搜索包含`k`的历史命令。
   - 另外，Ctrl+R是一个快捷键，用于在命令行中对历史记录进行反向搜索。输入Ctrl+R后，会提示你输入搜索字符串，然后会显示匹配的历史命令。找到需要的命令后，按回车键即可执行。

### 四、注意事项

1. 历史记录文件通常位于用户的主目录下，文件名为`.bash_history`。但也可以通过设置`HISTFILE`环境变量来更改历史记录文件的名称和位置。
2. 当同一账号同时登录多个终端时，只有最后一个退出的终端会将当前的命令记录写入历史文件。
3. 为了确保新会话追加命令到历史文件而不是覆盖，可以使用`shopt -s histappend`命令。
4. 在使用`history -d`删除历史记录时，请确保指定的偏移量或历史记录编号是正确的，以避免误删重要命令。

综上所述，history命令是Linux系统中一个非常有用的工具，它可以帮助用户查看和管理之前输入的命令。通过合理使用其各种选项和高级用法，用户可以更加高效地利用命令行进行操作。