---
title: 存储过程与函数的区别
article: false
order: 3
---

**存储过程（Stored Procedure）** 和 **函数（Function）** 是数据库中用于封装和重用 SQL 代码的两种对象。它们有许多相似之处，但也存在一些关键区别。以下是它们的详细对比：

---

## **1. 定义**

### **(1) 存储过程**
- 存储过程是一组预编译的 SQL 语句，可以接受输入参数并返回多个值（通过输出参数或结果集）。
- 存储过程可以执行复杂的业务逻辑，包括 DML（数据操作语言）和 DDL（数据定义语言）操作。

### **(2) 函数**
- 函数是一个预编译的 SQL 代码块，可以接受输入参数并返回单个值（标量值或表值）。
- 函数通常用于计算和返回一个值，不能执行 DML 或 DDL 操作。

---

## **2. 主要区别**

| 特性             | 存储过程（Stored Procedure）                      | 函数（Function）                 |
| ---------------- | ------------------------------------------------- | -------------------------------- |
| **返回值**       | 可以返回多个值（通过输出参数或结果集）。          | 必须返回一个值（标量值或表值）。 |
| **DML/DDL 操作** | 可以执行 DML 和 DDL 操作。                        | 不能执行 DML 和 DDL 操作。       |
| **调用方式**     | 使用 `CALL` 或 `EXECUTE` 调用。                   | 在 SQL 语句中直接调用。          |
| **参数类型**     | 支持输入参数、输出参数和输入输出参数。            | 只支持输入参数。                 |
| **使用场景**     | 适合执行复杂的业务逻辑。                          | 适合计算和返回单个值。           |
| **事务管理**     | 可以包含事务控制语句（如 `COMMIT`、`ROLLBACK`）。 | 不能包含事务控制语句。           |
| **返回结果集**   | 可以返回多个结果集。                              | 只能返回单个值（标量值或表值）。 |

---

## **3. 示例**

### **(1) 存储过程示例**
创建一个存储过程，用于插入用户数据并返回插入的用户 ID：
```sql
create procedure insert_user (
    in p_name varchar(50),
    in p_email varchar(100),
    out p_user_id int
)
begin
    insert into users (name, email) values (p_name, p_email);
    set p_user_id = last_insert_id();
end;

-- 调用存储过程
call insert_user('John Doe', 'john@example.com', @user_id);
select @user_id;
```

### **(2) 函数示例**
创建一个函数，用于计算两个数的和：
```sql
create function add_numbers (a int, b int)
returns int
begin
    return a + b;
end;

-- 调用函数
select add_numbers(10, 20);
```

---

## **4. 使用场景**

### **(1) 存储过程的使用场景**
- 执行复杂的业务逻辑。
- 执行 DML 和 DDL 操作。
- 返回多个结果集或输出参数。
- 需要事务控制的场景。

### **(2) 函数的使用场景**
- 计算和返回单个值。
- 在 SQL 语句中直接调用。
- 封装可重用的计算逻辑。

---

## **5. 注意事项**

### **(1) 存储过程的注意事项**
- 存储过程可以修改数据库状态，因此需要谨慎使用。
- 存储过程的执行效率较高，因为它们会被预编译。

### **(2) 函数的注意事项**
- 函数不能修改数据库状态，因此适合用于计算和查询。
- 函数可以在 SQL 语句中直接调用，适合用于复杂查询中的计算。

---

通过合理使用存储过程和函数，可以提高数据库代码的可重用性和可维护性，同时优化数据库的性能！
