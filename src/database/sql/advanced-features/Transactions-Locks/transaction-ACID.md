---
title: 事务的 ACID 特性
article: false
order: 1
---

**事务（Transaction）** 是数据库管理系统中的一组操作，这些操作要么全部成功，要么全部失败。事务的 ACID 特性是确保数据库操作正确性和一致性的关键。ACID 是以下四个特性的缩写：

---

## **1. 原子性（Atomicity）**
### **描述**
事务是一个不可分割的工作单元，事务中的所有操作要么全部成功，要么全部失败。

### **实现方式**
通过 **回滚（Rollback）** 机制实现。如果事务中的任何操作失败，数据库会将事务中的所有操作回滚到事务开始前的状态。

### **示例**
转账操作：
```sql
begin;
update accounts set balance = balance - 100 where id = 1;
update accounts set balance = balance + 100 where id = 2;
commit;
```
- 如果两个更新操作都成功，事务提交。
- 如果任何一个更新操作失败，事务回滚。

---

## **2. 一致性（Consistency）**
### **描述**
事务执行前后，数据库的状态必须保持一致。即事务必须将数据库从一个一致状态转换到另一个一致状态。

### **实现方式**
通过数据库的约束（如主键、外键、唯一性约束等）和业务规则来保证。

### **示例**
转账操作：
- 事务执行前，账户 1 的余额为 200，账户 2 的余额为 300。
- 事务执行后，账户 1 的余额为 100，账户 2 的余额为 400。
- 总余额保持一致（200 + 300 = 100 + 400）。

---

## **3. 隔离性（Isolation）**
### **描述**
多个事务并发执行时，每个事务的操作与其他事务隔离，互不干扰。

### **实现方式**
通过 **隔离级别（Isolation Level）** 控制：
- **读未提交（Read Uncommitted）**: 最低级别，事务可以读取未提交的数据。
- **读已提交（Read Committed）**: 事务只能读取已提交的数据。
- **可重复读（Repeatable Read）**: 事务执行期间，多次读取同一数据的结果一致。
- **串行化（Serializable）**: 最高级别，事务串行执行，完全隔离。

### **示例**
事务 A 和事务 B 同时执行：
- 事务 A 读取账户 1 的余额。
- 事务 B 更新账户 1 的余额。
- 根据隔离级别，事务 A 可能读取到事务 B 更新前或更新后的数据。

---

## **4. 持久性（Durability）**
### **描述**
事务提交后，对数据库的更改是永久性的，即使系统发生故障也不会丢失。

### **实现方式**
通过 **日志（Log）** 机制实现。数据库将事务的更改记录到日志中，即使系统崩溃，也可以通过日志恢复数据。

### **示例**
转账操作：
- 事务提交后，账户 1 的余额为 100，账户 2 的余额为 400。
- 即使系统崩溃，数据库恢复后，账户余额仍为 100 和 400。

---

## **5. 事务的 ACID 特性总结**

| 特性       | 描述                                         | 实现方式       |
| ---------- | -------------------------------------------- | -------------- |
| **原子性** | 事务中的所有操作要么全部成功，要么全部失败。 | 回滚机制       |
| **一致性** | 事务执行前后，数据库的状态必须保持一致。     | 约束和业务规则 |
| **隔离性** | 多个事务并发执行时，互不干扰。               | 隔离级别       |
| **持久性** | 事务提交后，对数据库的更改是永久性的。       | 日志机制       |

---

## **6. 示例应用**

### **(1) 转账操作**
```sql
begin;
update accounts set balance = balance - 100 where id = 1;
update accounts set balance = balance + 100 where id = 2;
commit;
```

### **(2) 事务回滚**
```sql
begin;
update accounts set balance = balance - 100 where id = 1;
update accounts set balance = balance + 100 where id = 2;
rollback;
```

---

通过理解和应用事务的 ACID 特性，可以确保数据库操作的正确性、一致性和可靠性！
