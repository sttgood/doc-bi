---
title: 位运算符
article: false
order: 4
---

在 SQL 中，位运算符用于对整数类型的数据进行位级别的操作。位运算符直接操作数据的二进制表示形式，适用于处理二进制数据或标志位。以下是 SQL 中常用的位运算符及其说明：

---

### 1. **位运算符列表**

| 运算符 | 描述     | 示例     |
| ------ | -------- | -------- |
| `&`    | 按位与   | `a & b`  |
| `|`    | 按位或   | `a | b`  |
| `^`    | 按位异或 | `a ^ b`  |
| `~`    | 按位取反 | `~a`     |
| `<<`   | 左移     | `a << b` |
| `>>`   | 右移     | `a >> b` |

---

### 2. **运算符详解**

#### 2.1 **按位与 (`&`)**
对两个操作数的二进制表示进行按位与操作，结果为 1 的位仅在两个操作数的对应位都为 1 时成立。

#### 示例：
```sql
select 5 & 3; -- 结果为 1
```
解释：
```
5 的二进制：101
3 的二进制：011
按位与结果：001 (十进制 1)
```

#### 2.2 **按位或 (`|`)**
对两个操作数的二进制表示进行按位或操作，结果为 1 的位在至少一个操作数的对应位为 1 时成立。

#### 示例：
```sql
select 5 | 3; -- 结果为 7
```
解释：
```
5 的二进制：101
3 的二进制：011
按位或结果：111 (十进制 7)
```

#### 2.3 **按位异或 (`^`)**
对两个操作数的二进制表示进行按位异或操作，结果为 1 的位在两个操作数的对应位不同时成立。

#### 示例：
```sql
select 5 ^ 3; -- 结果为 6
```
解释：
```
5 的二进制：101
3 的二进制：011
按位异或结果：110 (十进制 6)
```

#### 2.4 **按位取反 (`~`)**
对操作数的二进制表示进行按位取反操作，即将所有位反转（0 变 1，1 变 0）。

#### 示例：
```sql
select ~5; -- 结果为 -6
```
解释：
```
5 的二进制：0000 0101
按位取反：1111 1010 (补码表示，对应十进制 -6)
```

#### 2.5 **左移 (`<<`)**
将操作数的二进制表示向左移动指定的位数，右侧补 0。

#### 示例：
```sql
select 5 << 1; -- 结果为 10
```
解释：
```
5 的二进制：101
左移 1 位：1010 (十进制 10)
```

#### 2.6 **右移 (`>>`)**
将操作数的二进制表示向右移动指定的位数，左侧补 0（对于无符号数）或补符号位（对于有符号数）。

#### 示例：
```sql
select 5 >> 1; -- 结果为 2
```
解释：
```
5 的二进制：101
右移 1 位：010 (十进制 2)
```

---

### 3. **在查询中使用位运算符**
位运算符可以直接用于查询中，对表中的数据进行位操作。

#### 示例：
假设有一个 `flags` 表，包含一个 `value` 列，存储二进制标志位：
```sql
create table flags (
    id int auto_increment primary key,
    value int
);

insert into flags (value)
values (5), (3), (7);
```

#### 查询按位与结果：
```sql
select value, value & 3 as result
from flags;
```

#### 结果：
| value | result |
| ----- | ------ |
| 5     | 1      |
| 3     | 3      |
| 7     | 3      |

#### 查询按位或结果：
```sql
select value, value | 3 as result
from flags;
```

#### 结果：
| value | result |
| ----- | ------ |
| 5     | 7      |
| 3     | 3      |
| 7     | 7      |

---

### 4. **注意事项**
- **数据类型**：位运算符只能用于整数类型（如 `INT`、`BIGINT` 等）。
- **符号位**：对于有符号整数，右移操作会保留符号位（即负数右移后仍为负数）。
- **性能**：位运算符通常比算术运算符更快，适合处理二进制数据或标志位。

---

### 5. **综合示例**
以下是一个综合示例，展示如何在查询中使用位运算符：
```sql
select 
    value,
    value & 3 as bitwise_and,
    value | 3 as bitwise_or,
    value ^ 3 as bitwise_xor,
    value << 1 as left_shift,
    value >> 1 as right_shift
from flags;
```

#### 结果：
| value | bitwise_and | bitwise_or | bitwise_xor | left_shift | right_shift |
| ----- | ----------- | ---------- | ----------- | ---------- | ----------- |
| 5     | 1           | 7          | 6           | 10         | 2           |
| 3     | 3           | 3          | 0           | 6          | 1           |
| 7     | 3           | 7          | 4           | 14         | 3           |

---

通过掌握 SQL 中的位运算符，您可以高效地处理二进制数据或标志位，满足特定的业务需求。
