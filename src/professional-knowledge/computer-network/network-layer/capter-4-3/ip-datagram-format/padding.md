---
title: 14.填充
article: false
order: 14
---


## IPv4 数据报格式

IPv4 数据报由首部和数据两部分构成，其中首部包含了关键的控制和寻址信息，具体如下：

### 1.版本（Version）

- 占 4 位。该字段明确了 IP 协议的版本。通过识别版本号，网络设备能确定使用何种规则来处理和解析数据报。
- IPv4：值固定为4，对应的二进制是0100。
- IPv6：值固定为6，表示IP协议的最新版本。

### 2.首部长度（Header Length）

- 占 4 位。它以 4 字节为单位来表示 IP 首部的长度。
- 因为 IPv4 首部可能包含可变长度的选项字段，所以需要这个字段来确定首部的实际长度。
- 最小值为 5，表示没有可选字段，首部长度为 20 字节；常用值通常为5（20字节），表示没有使用选项字段的标准IP数据报首部长度。
- 最大值为 15，对应首部长度为 60 字节。

### 3.区分服务（Differentiated Services）

- 占 8 位。前 6 位是 DSCP（Differentiated Services Code Point），用于区分不同类型的服务和数据包的优先级，如可以为实时视频流、音频流等设置较高的优先级，以确保它们能获得更好的网络服务质量。后 2 位保留未用。
- 一般情况下不使用此字段，常用值为00000000。
- 但在使用区分服务（DiffServ）时，此字段会设置为特定的值以指示数据报的服务要求。

### 4.总长度（Total Length）

- 占 16 位。以字节为单位，它指示了整个 IP 数据报（包括首部和数据部分）的总长度。由于该字段是 16 位，所以 IPv4 数据报的最大长度为 65535 字节。这个字段让接收方知道应该接收多少数据。实际长度取决于数据部分的大小，常用值范围从几十字节到几千字节不等。
-

### 5.标识符（Identifier）

- 占 16 位。在数据报需要分片和重组的情况下，标识符用于标识属于同一个原始数据报的不同分片。当一个大数据报需要被分割成多个较小的分片进行传输时，每个分片都会携带相同的标识符，以便在接收端能正确地将它们重组还原为原始数据报。
- 常用值为一个递增的计数器值，每产生一个数据报就加1。

### 6.标志（Flags）

- 占 3 位。第一位保留未使用；第二位是 DF（Don't Fragment）位，若网络中路由器发现数据报太大而不能在链路上传输且 DF 位为 1，则会丢弃该数据报并向源主机发送错误消息；第三位是 MF（More Fragments）位，。
- 包含DF（Don't Fragment）和MF（More Fragment）两位。
  - DF=1：表示不允许分片。
  - DF=0：表示允许分片。
  - MF=1：表示后面还有分片。
  - MF=0：表示这是最后一个分片或没有分片。
- 常用组合值：
  - DF=0, MF=1：表示数据报已分片，且后面还有分片。
  - DF=0, MF=0：表示数据报已分片，且这是最后一个分片。
  - DF=1, MF=0：表示数据报不允许分片，且这是唯一的数据报（未分片）。

### 7.片偏移（Fragment Offset）

- 占 13 位。以 8 字节为单位，表示该分片在原始 IP 数据报中的相对偏移量。例如，某个分片的片偏移为 10，意味着它在原始数据报中的位置是从第 80 字节开始。通过片偏移和标识符、标志位等信息，接收方可以准确地将分片按顺序重组。

### 8.生存时间（Time to Live, TTL）

- 占 8 位。它指定了 IP 数据报在网络中可以经过的最大跳数。每经过一个路由器，TTL 值就会减 1，当 TTL 值减为 0 时，路由器会丢弃该数据报。这一机制可以防止数据报在网络中无限循环。

### 9.协议（Protocol）

- 占 8 位。该字段标识了 IP 数据报所承载的上层协议，。通过这个字段，接收方可以知道应该将数据报交给哪个上层协议进行处理。

### 10.首

| 协议名     | ICMP | IGMP | IP   | TCP  | EGP  | IGP  | UDP  | IPV6 | ESP  | OSPF |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 协议字段值 | 1    | 2    | 4    | 6    | 8    | 9    | 17   | 17   | 50   | OSPF |

:::details 所有协议

| 协议字段值 | 协议名称                                                |
| ---------- | ------------------------------------------------------- |
| 0          | 保留字段，用于 IPv6 的跳跃点到跳跃点选项                |
| 1          | Internet 控制消息（ICMP）                               |
| 2          | Internet 组管理（IGMP）                                 |
| 3          | 网关到网关（GGP）                                       |
| 4          | IP 中的 IP（封装）                                      |
| 5          | 流                                                      |
| 6          | 传输控制（TCP）                                         |
| 7          | CBT                                                     |
| 8          | 外部网关协议（EGP）                                     |
| 9          | 任何私有内部网关（Cisco 在它的 IGRP 实现中使用）（IGP） |
| 10         | BBN RCC 监视                                            |
| 11         | 网络语音协议                                            |
| 12         | PUP                                                     |
| 13         | ARGUS                                                   |
| 14         | EMCON                                                   |
| 15         | 网络诊断工具                                            |
| 16         | 混乱（Chaos）                                           |
| 17         | 用户数据报文（UDP）                                     |
| 18         | 复用                                                    |
| 19         | DCN 测量子系统                                          |
| 20         | 主机监视                                                |
| 21         | 包无线测量                                              |
| 22         | XEROX NS IDP                                            |
| 23         | Trunk-1                                                 |
| 24         | Trunk-2                                                 |
| 25         | leaf-1                                                  |
| 26         | leaf-2                                                  |
| 27         | 可靠的数据协议                                          |
| 28         | Internet 可靠交易                                       |
| 29         | ISO 传输协议第四类（TP4）                               |
| 30         | 大块数据传输协议                                        |
| 31         | MFE 网络服务协议                                        |
| 32         | MERIT 节点之间协议                                      |
| 33         | 序列交换协议                                            |
| 34         | 第三方连接协议                                          |
| 35         | 域之间策略路由协议                                      |
| 36         | XTP                                                     |
| 37         | 数据报文传递协议                                        |
| 38         | IDPR 控制消息传输协议                                   |
| 39         | TP++ 传输协议                                           |
| 40         | IL 传输协议                                             |
| 41         | IPv6                                                    |
| 42         | 资源命令路由协议                                        |
| 43         | IPv6 的路由报头                                         |
| 44         | IPv6 的片报头                                           |
| 45         | 域之间路由协议                                          |
| 46         | 保留协议                                                |
| 47         | 通用路由封装                                            |
| 48         | 可移动主机路由协议                                      |
| 49         | BNA                                                     |
| 50         | IPv6 封装安全有效负载                                   |
| 51         | IPv6 验证报头                                           |
| 52         | 集成的网络层安全 TUBA                                   |
| 53         | 带加密的 IP                                             |
| 54         | NBMA 地址解析协议                                       |
| 55         | IP 可移动性                                             |
| 56         | 使用 Kryptonet 钥匙管理的传输层安全协议                 |
| 57         | SKIP                                                    |
| 58         | IPv6 的 ICMP                                            |
| 59         | IPv6 的无下一个报头                                     |
| 60         | IPv6 的信宿选项                                         |
| 61         | 任何主机内部协议                                        |
| 62         | CFTP                                                    |
| 63         | 任何本地网络                                            |
| 64         | SATNET 和 Backroom EXPAK                                |
| 65         | Kryptolan                                               |
| 66         | MIT 远程虚拟磁盘协议                                    |
| 67         | Internet Pluribus 包核心                                |
| 68         | 任何分布式文件系统                                      |
| 69         | SATNET 监视                                             |
| 70         | VISA 协议                                               |
| 71         | Internet 包核心工具                                     |
| 72         | 计算机协议 Network Executive                            |
| 73         | 计算机协议 Heart Beat                                   |
| 74         | Wang Span 网络                                          |
| 75         | 包视频协议                                              |
| 76         | Backroom SATNET 监视                                    |
| 77         | SUN ND PROTOCOL— 临时                                   |
| 78         | WIDEBAND 监视                                           |
| 79         | WIDEBAND EXPAK                                          |
| 80         | ISO Internet 协议                                       |
| 81         | VMTP                                                    |
| 82         | SECURE—VMTP（安全的 VMTP）                              |
| 83         | VINES                                                   |
| 84         | TTP                                                     |
| 85         | NSFNET—IGP                                              |
| 86         | 不同网关协议                                            |
| 87         | TCF                                                     |
| 88         | EIGRP                                                   |
| 89         | OSPF IGP                                                |
| 90         | Sprite RPC 协议                                         |
| 91         | Locus 地址解析协议                                      |
| 92         | 多播传输协议                                            |
| 93         | AX.25 帧                                                |
| 94         | IP 内部的 IP 封装协议                                   |
| 95         | 可移动网络互连控制协议                                  |
| 96         | 旗语通讯安全协议                                        |
| 97         | IP 中的以太封装                                         |
| 98         | 封装报头                                                |
| 99         | 任何私有加密方案                                        |
| 100        | GMTP                                                    |
| 101        | Ipsilon 流量管理协议                                    |
| 102        | PNNI over IP                                            |
| 103        | 协议独立多播                                            |
| 104        | ARIS                                                    |
| 105        | SCPS                                                    |
| 106        | QNX                                                     |
| 107        | 活动网络                                                |
| 108        | IP 有效负载压缩协议                                     |
| 109        | Sitara 网络协议                                         |
| 110        | Compaq 对等协议                                         |
| 111        | IP 中的 IPX                                             |
| 112        | 虚拟路由器冗余协议                                      |
| 113        | PGM 可靠传输协议                                        |
| 114        | 任何 0 跳跃协议                                         |
| 115        | 第二层隧道协议                                          |
| 116        | D-II 数据交换（DDX）                                    |
| 117        | 交互式代理传输协议                                      |
| 118        | 日程计划传输协议                                        |
| 119        | SpectraLink 无线协议                                    |
| 120        | UTI                                                     |
| 121        | 简单消息协议                                            |
| 122        | SM                                                      |
| 123        | 性能透明性协议                                          |
| 124        | ISIS over IPv4                                          |
| 125        | FIRE                                                    |
| 126        | Combat 无线传输协议                                     |
| 127        | Combat 无线用户数据报文                                 |
| 128        | SSCOPMCE                                                |
| 129        | IPLT                                                    |
| 130        | 安全包防护                                              |
| 131        | IP 中的私有 IP 封装                                     |
| 132        | 流控制传输协议                                          |
| 133-254    | 未分配                                                  |
| 255        | 保留                                                    |

:::

### 部检验和（Header Checksum）

- 占 16 位。它用于检验 IP 数据报首部在传输过程中是否发生错误。计算方法是对首部中的每 16 位进行二进制反码求和，接收方在收到数据报后会重新计算检验和，如果计算结果与接收到的检验和不一致，则说明首部在传输过程中出现了错误，会丢弃该数据报。

### 11.源 IP 地址（Source IP Address）

- 占 32 位。它标识了发送该 IP 数据报的源主机的 IP 地址，用于让接收方知道数据的来源，同时也用于网络中的路由选择和数据包的反向追踪等。

### 12.目的 IP 地址（Destination IP Address）

- 占 32 位。标识了接收该 IP 数据报的目的主机的 IP 地址，是数据报在网络中传输的目标地址，网络中的路由器根据目的 IP 地址来决定数据报的转发路径。

### 13.选项（Options）

- 长度可变。选项字段用于实现一些可选的功能，如记录路由（让路由器记录数据报经过的路径）、时间戳（记录数据报经过每个路由器的时间）、源路由（由源主机指定数据报要经过的路径）等。不是所有的 IP 数据报都包含选项字段，只有在需要特定功能时才会使用。

### 14.填充（Padding）

- 由于 IP 首部长度必须是 4 字节的整数倍，当选项字段的长度不是 4 字节的整数倍时，需要使用填充字段来补齐，以确保数据报的结构规整，便于网络设备进行处理。

:::details IPv6 数据报格式

IPv6 数据报由基本首部和有效载荷组成，有效载荷可能包含扩展首部和上层协议数据，以下是各部分的详细说明：

### 1.版本（Version）

- 占 4 位。对于 IPv6，该字段值固定为 6，用于标识协议版本，使网络设备能够正确识别和处理 IPv6 数据报。

### 2.流量类别（Traffic Class）

- 占 8 位。类似于 IPv4 中的区分服务字段，用于表示数据报的优先级或服务类型，网络可以根据这个字段对不同类型的数据进行差异化的处理，例如为实时应用、关键业务等分配更高的优先级。

### 3.流标签（Flow Label）

- 占 20 位。用于标识属于同一个流的数据包。一个流可以是从一个源主机到一个目的主机的一系列具有相同特征的数据包，如同一视频流或同一文件传输的数据包。流标签可让路由器对具有相同流标签的数据包进行特殊处理，以满足特定的服务质量需求。

### 4.有效载荷长度（Payload Length）

- 占 16 位。以字节为单位，表示 IPv6 数据报中除基本首部以外的数据部分的长度，不包括基本首部的长度。它明确了有效载荷的大小，让接收方能够准确地提取数据。

### 5.下一个首部（Next Header）

- 占 8 位。标识紧跟在 IPv6 基本首部后面的扩展首部或上层协议。如果下一个首部是扩展首部，则该字段的值对应扩展首部的类型；如果是上层协议，则值与 IPv4 中的协议字段类似，如值为 6 表示 TCP，17 表示 UDP 等，用于指示接收方应该将数据交给哪个上层协议处理。

### 6.跳数限制（Hop Limit）

- 占 8 位。类似于 IPv4 中的生存时间字段，每经过一个路由器，跳数限制值减 1，当跳数限制值为 0 时，数据报将被丢弃，以此防止数据报在网络中无限循环。

### 7.源 IP 地址（Source IP Address）

- 占 128 位。发送方的 IP 地址，提供了巨大的地址空间，能够满足未来大量设备接入网络的需求，也为更灵活的网络配置和地址分配提供了可能。

### 8.目的 IP 地址（Destination IP Address）

- 占 128 位。接收方的 IP 地址，用于引导数据报在网络中的传输方向，确保数据能够准确地到达目标设备。
:::
