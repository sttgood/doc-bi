---
title: 层叠机制
article: false
order: 1
---

CSS 的层叠性（Cascading）是 CSS 的核心特性之一，它决定了当多个样式规则应用于同一个元素时，浏览器如何选择最终的样式。层叠性主要基于以下三个因素：

---

### **1. 层叠性的来源**
CSS 的层叠性主要来源于以下几个方面：
1. **样式来源**：不同来源的样式规则（如用户样式、浏览器默认样式、开发者样式）。
2. **选择器优先级**：不同选择器的权重决定了样式的优先级。
3. **声明顺序**：相同优先级的样式，后定义的规则会覆盖先定义的规则。

---

### **2. 样式来源的优先级**
CSS 样式来源的优先级从低到高依次为：
1. **用户代理样式（User Agent Styles）**  
   • 浏览器默认样式（如 `<h1>` 的字体大小）。
2. **用户样式（User Styles）**  
   • 用户自定义的样式（如浏览器扩展或用户样式表）。
3. **开发者样式（Author Styles）**  
   • 开发者编写的样式（如外部样式表、内部样式表、内联样式）。
4. **`!important` 声明**  
   • 使用 `!important` 的样式优先级最高，会覆盖其他来源的样式。

---

### **3. 选择器优先级**
选择器的优先级通过权重计算，权重从高到低依次为：
1. **内联样式**  
   • 权重：`1000`  
   • 示例：`<p style="color: red;">`。
2. **ID 选择器**  
   • 权重：`100`  
   • 示例：`#header`。
3. **类选择器、属性选择器、伪类**  
   • 权重：`10`  
   • 示例：`.btn`、`[type="text"]`、`:hover`。
4. **元素选择器、伪元素**  
   • 权重：`1`  
   • 示例：`div`、`::before`。

#### **权重计算规则**
• 将选择器的权重相加，总和越高，优先级越高。
• 示例：  
  ```css
  #header .btn {} /* 权重：100 + 10 = 110 */
  .btn.active {}  /* 权重：10 + 10 = 20 */
  div p {}        /* 权重：1 + 1 = 2 */
  ```

---

### **4. 声明顺序**
当多个样式规则的优先级相同时，**后定义的规则会覆盖先定义的规则**。

#### **示例**
```css
p { color: red; }
p { color: blue; } /* 最终颜色为蓝色 */
```

---

### **5. `!important` 规则**
`!important` 用于提升样式的优先级，覆盖其他规则。

#### **语法**
```css
p {
  color: red !important;
}
```

#### **注意事项**
• **慎用**：过度使用 `!important` 会导致样式难以维护。
• **优先级**：`!important` 的优先级高于普通样式，但多个 `!important` 之间仍按权重和声明顺序决定。

---

### **6. 层叠性示例**
以下是一个综合示例，展示了层叠性的具体应用：

```html
<p id="text" class="highlight" style="color: green;">Hello, World!</p>
```

```css
p { color: red; }                /* 权重：1 */
.highlight { color: blue; }      /* 权重：10 */
#text { color: yellow; }         /* 权重：100 */
p { color: purple !important; } /* 权重：1 + !important */
```

#### **解析**
1. **`!important` 规则**：`color: purple` 优先级最高。
2. **内联样式**：`style="color: green"` 优先级次之，但被 `!important` 覆盖。
3. **ID 选择器**：`#text { color: yellow; }` 权重为 100。
4. **类选择器**：`.highlight { color: blue; }` 权重为 10。
5. **元素选择器**：`p { color: red; }` 权重为 1。

#### **最终样式**
```html
<p style="color: purple;">Hello, World!</p>
```

---

### **7. 层叠性最佳实践**
1. **避免过度使用 `!important`**：优先通过选择器权重和声明顺序控制样式。
2. **模块化 CSS**：使用 BEM、CSS Modules 等方法，减少样式冲突。
3. **合理使用选择器**：尽量使用低权重的选择器，避免复杂嵌套。
4. **工具辅助**：使用 Lint 工具（如 Stylelint）检查样式优先级问题。

