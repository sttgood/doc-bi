---
title: --provenance
article: false
---

`npm publish` 的 `--provenance` 参数是 npm 提供的一个安全特性，用于在发布包时记录和验证软件来源（provenance）。这个功能旨在增强供应链的安全性，确保发布的包可以被追溯到其原始构建环境，并且未被篡改。通过启用 `--provenance`，你可以在发布时生成一个来源声明（provenance statement），该声明包含有关构建过程的详细信息。

### 什么是来源声明（Provenance Statement）

来源声明是一个 JSON 格式的文档，描述了软件包是如何构建的，包括：

- **构建时间**：软件包何时被构建。
- **构建环境**：构建发生的操作系统、工具链和其他环境细节。
- **依赖关系**：构建过程中使用的依赖项及其版本。
- **签名**：对来源声明进行数字签名，以确保其完整性和真实性。

这些信息对于确保软件包的真实性和完整性非常重要，特别是在供应链攻击日益增多的情况下。

### 使用 `--provenance` 参数

#### 启用来源声明

要启用来源声明，在发布命令中添加 `--provenance` 参数：

```bash
npm publish --provenance
```

这将生成并上传一个来源声明文件，与你的包一起发布到 npm 注册表。

#### 结合其他选项使用

你可以将 `--provenance` 与其他发布选项结合使用，例如：

- **标签**：为发布的包设置标签。
  
  ```bash
  npm publish --provenance --tag=beta
  ```

- **访问权限**：设置发布的包是公共还是私有的。
  
  ```bash
  npm publish --provenance --access=public
  ```

- **一次性密码 (OTP)**：如果你启用了双因素认证（2FA），可以在发布时提供 OTP。
  
  ```bash
  npm publish --provenance --otp=123456
  ```

- **模拟发布**：使用 `--dry-run` 参数来模拟发布过程而不实际发布。
  
  ```bash
  npm publish --provenance --dry-run
  ```

### 注意事项

- **配置构建工具**：为了生成准确的来源声明，你需要确保构建工具和环境正确配置。这可能涉及到使用特定的构建系统或 CI/CD 平台的功能。
- **依赖关系管理**：确保所有依赖项都来自可信源，并且版本固定，以避免潜在的安全风险。
- **签名和验证**：来源声明通常会进行数字签名，以确保其真实性和完整性。用户可以验证这些签名来确认包的来源。
- **安全性**：启用来源声明可以帮助提高供应链的安全性，但不能单独解决所有问题。它应该与其他安全措施（如代码审查、依赖审计等）一起使用。

### 实际应用场景

1. **增强供应链安全**：通过记录和验证构建过程，确保发布的包未被篡改。
2. **合规性**：满足某些行业标准或法规要求，需要详细的构建和发布记录。
3. **透明度**：向用户展示包的构建历史，增加对项目的信任。

### 示例

假设你有一个名为 `my-package` 的项目，并且希望发布时启用来源声明：

1. **发布带有来源声明的包**：
   ```bash
   npm publish --provenance
   ```

2. **发布带有来源声明和特定标签的包**：
   ```bash
   npm publish --provenance --tag=beta
   ```

3. **发布带有来源声明和私有访问权限的包**：
   ```bash
   npm publish --provenance --access=restricted
   ```

### 总结

`npm publish --provenance` 参数是一个重要的安全特性，它帮助你在发布 npm 包时记录和验证软件来源，从而增强供应链的安全性。通过合理利用这个参数，你可以显著提升发布的包的安全性和可信度，确保用户能够放心地使用你的软件。同时，在团队协作和组织管理中，正确配置来源声明可以有效促进项目的透明度和合规性。

### 进一步阅读

如果你想要了解更多关于来源声明的技术细节和最佳实践，建议查阅 npm 官方文档和其他相关资源。此外，了解如何在你的构建环境中集成来源声明也是一个重要的步骤，以确保发布的包具有最高的安全性和可信度。
